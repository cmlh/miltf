MILTF
=====
Mtgx & Ioc Load & Transform for netForensic:
- Search recursively for IOC and MTGX (Paterva Maltego/Casefile) file from a configured path
- Extract IP and FQDN information from located files
- Research, listing and comparaison functions

The goal is to compare an input (string or file) with others files on the analyst computer or remote server. If they are match, MILTF do not give much information. It returns minimum information and where the matched files are stored. The analyst then can find its matched files and review it. It has to be considered as a kind of 'index', and not an investigation or decision support script.

Improvment:
MILTF is dropped here. It reply to some needs I'd to face and it is one possible answer. I do not really plan to maintain it or do not promisse to add new functionnalities or work on it or publish following work.
Some possible issues/improvments:
- I'm not really sure about the --exclude (-e) whitelisting efficiency
- Module: gps_* scripts can be combine in one
- MTGX Extraction: is read as text file because lazy, parse it as XML would be cleaner and faster
- Module: filer script's methods can be combined in one

And please not I'm not a developper :) Enjoy!

=====
# How is it structure?
MILTF is composed of one entry script (miltf.py) et four folders:
- module: scripts to extract data, manipulate data, wrap the outputs
- output: where are stored output files (option -o/--output txt)
- ressource: IOC/MTGX/TXT examples files; tool banner; whitelist
- store: MILTF configuration file (store/miltf.cfg) and backup file of the Working Base (WB)  generated by the -co/--cache-out argument, named wb.csv

# How does it work?
When launch, MILTF take in the config file the root folder to search IOC and MTGX files. It then search for this kind of file from this root, extract IPv4 and FQDN from each of finded files, then create the Working base in memory.
After that, it take care of the arguments.

# What it does?
Their are four main search type:
- find all files depending of one search axe: IOC, MTGX, IPv4 or Domain
- search an IP or a (part of) FQDN in the WB
- matching a given MTGX or IOC file with the WB
- compare to file to each other

## File matching type
Their are two way MILTF match files to the Working Base:
- check: give for each element (IPv4 or FQDN) of the input file where it can be found in the IOC and MTGX files loaded in the WB
- comparaison: give the number of hit elements beetween the input file and matched Working Base entries

## File output type
Their are three output type:
- (default) var: return result to stdout (from extern script)
- txt: create a txt result file in a CSV format
- term: print the result with a more human readable formatting

## Special arguments
Their are four special options:
- api: search elements in the ThreatRecon knowledge base and if found return the Attribution information (API key to set up in store/miltf.cfg; Free API Threashold: 4req / min)
- exclude: clean the output from domain and IP listed in the configured whitelist file
- cache-in: after building up the Working Base, MILTF save an image of it in a csv file (store/wb.csv)
- cache-out: if a previous cache-in has been done, load the Working base from the cache-in image

=====
# Help
python3 miltf.py -h

=====
# Configuration
In store/miltf.cfg: 
- IOC_FOLDER_PATH: the folder from which you want the IOC file search start (eg: =/home/user/work/IOC)
- MTGX_FOLDER_PATH: the folder from which you want the MTGX file search start (eg: =/home/user/work/Casefile)
WHITELIST_PATH: the file containing domains and IPv4 you want to be exclude from result (default: =./ressource/top-1000.lst)
- CACHE_IN: (des)activation of the cache-in at start (default: =False)
- CACHE_OUT: (des)activation of the cache-out at start (default: =False)
- WHITELIST: (des)activation of the whitelisting at start (default: =False)
- THREAT_RECON_API: just an example of an API use. (=[YOUR THREATRECON API KEY])
- API_ACTIVE(des)activation of the API check of results (default: =False)


=====
# Use Case Example

## Search Domain name and print the result
python3 miltf.py -d cnndaily.com -o term

## Search Domain name and save the output in a file
python3 miltf.py -d cnndaily.com -o txt

## Search IP and save the output in a file
python3 miltf.py -i 67.229.65.125  -o txt

## Search all IOC in the Working Base and save the result in a file
python3 miltf.py -a ioc -o txt

To get all:
- ioc: -a ioc
- mtgx: -a mtgx
- ip: -a ipv4
- domains: -a dom

## Check an IOC
python3 miltf.py -o term --check-ioc  /path/to/ioc/to/check

## Compare an IOC
python3 miltf.py -o term --comp-ioc  /path/to/ioc/to/check

## Check a MTGX
python3 miltf.py -o term --check-mtgx  /path/to/mtgx/to/check

## Compare a MTGX
python3 miltf.py -o term --comp-mtgx  /path/to/mtgx/to/check

## Check or Compare a TXT file
MILTF can check or compare a TXT file, build with one IP/domains per line
args:
- --check-txt
- --comp-txt
 
## Compare two files
The path of both file have to be put after --comp-twix, separed by a double equal sign '=='. Order does not matter and files can be MTGX, TXT or IOC.

miltf.py -o term --comp-twix /path/to/mtgx1==/path/to/ioc8

## Activate API with command line
Whitelisting is set to False by default but you can change it in the store/miltf.cfg to True.
For one shot, use the -e/--exclude arg
eg:
python3 miltf.py -o term -d yahoo.com
python3 miltf.py -o term -d yahoo.com -e

## Save the Working Base
Just put -ci/--cache_in in your command. MILTF will then load elements from the store/wb.csv file instead of searching files, extract elements and format it.
By design, if you use whitelisting, cache-in is done once the whitelisting operation done.
If you upload of add new IOC/MTGX files, then don't forget to update the CSV cache file.
This operation take about the double of time compared to a regular load

## Load the Working Base Image
Just put -co/--cache_out in your command. MILTF will then load elements from the store/wb.csv file instead of searching files, extract elements and format it.
If their has been previously no cache-in, or if the store/wb.csv file has been deleted, it will return an error at start.
Loading information this way can take >10 time less time than the regular load.

